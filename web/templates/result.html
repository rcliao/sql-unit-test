<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Test Result</title>

    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">
    <link rel="stylesheet" href="/static/app.css">
</head>
<body>
    <h1>Test Results</h1>
    <main class="container">
    {{range $index, $element := .}}
        <div class="result-container">
            <h2>Test Case #{{$element.Expected.Index}}</h2>

            <div class="query">
                <h3>Submitted Query</h3>
                <pre><code class="sql">{{$element.Actual.Query}}</code></pre>
            </div>

            {{if $element.Pass}}
            <div class="feedback pass">
                Test pass!
            </div>
            {{else}}
            <div class="feedback failed">
                Test failed.
                {{if $element.Error}}
                <div>
                    <h3>SQL Syntax Error</h3>
                    <p>{{$element.Error}}</p>
                </div>
                {{end}}
            </div>
            <div>
                Test Cases Layout:
                <div class="btn-group layout-toggle" data-id="{{$element.Expected.Index}}">
                    <button class="row active">Row</button>
                    <button class="column">Column</button>
                </div>
            </div>
            <div class="test-cases" id="test_cases_{{$element.Expected.Index}}">
                <div class="expected">
                    <h3>Expected</h3>
                    <table>
                        <thead>
                            <tr>
                                {{range $key, $value := index $element.Expected.Content 0}}
                                <th>{{$key}}</th>
                                {{end}}
                            </tr>
                        </thead>
                        <tbody>
                            {{range $element.Expected.Content}}
                            <tr>
                                {{range $key, $value := .}}
                                <td>{{$value}}</td>
                                {{end}}
                            </tr>
                            {{end}}
                        </tbody>
                    </table>
                </div>

                <div class="actual">
                    <h3>Actual</h3>
                    {{if not $element.Actual.Content}}
                    <p>No data</p>
                    {{else}}
                    <table>
                        <thead>
                            <tr>
                                {{range $key, $value := index $element.Actual.Content 0}}
                                <th>{{$key}}</th>
                                {{end}}
                            </tr>
                        </thead>
                        <tbody>
                            {{range $element.Actual.Content}}
                            <tr>
                                {{range $key, $value := .}}
                                <td>{{$value}}</td>
                                {{end}}
                            </tr>
                            {{end}}
                        </tbody>
                    </table>
                    {{end}}
                </div>
            </div>
            {{end}}
        </div>
    {{end}}
    </main>

    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    <script>
        var toggles = document.querySelectorAll('.layout-toggle');
        for (var i = 0; i < toggles.length; i ++) {
            var dataId = toggles[i].dataset.id;
            var displayElement = document.querySelector('#test_cases_' + dataId);
            var rowButton = toggles[i].querySelector('.row');
            var columnButton = toggles[i].querySelector('.column');
            rowButton.addEventListener('click', function() {
                rowButton.classList.add('active');
                columnButton.classList.remove('active');
                displayElement.classList.add('row');
                displayElement.classList.remove('column');
            });
            columnButton.addEventListener('click', function() {
                rowButton.classList.remove('active');
                columnButton.classList.add('active');
                displayElement.classList.remove('row');
                displayElement.classList.add('column');
            });
        }
    </script>
</body>
</html>
